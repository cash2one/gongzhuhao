angular.module('zenmezApp')  .controller('TopicListCtrl', function ($scope, $state, $http, $stateParams, $window, $timeout , $location) {  	$scope.model = {};  	$scope.isLoading = true;    var pid = 1 , //页码        cid = 2 , //类型   1：最新发布，2：最后回复，3：精华话题        is_one_page = 1 ,        is_two_page = 1 ,        is_three_page = 1,        one_pid = 1 ,        two_pid = 1 ,        three_pid = 1,        sid = $stateParams.id;  //分类    $scope.noMoreItemsAvailable = false;    function fetchData(){      var promise = $http.get("/mobile/topics/query/" + sid + '/' + pid);      promise.success(function(rs ,state ){        one_pid =2;        two_pid = three_pid = one_pid;        $scope.noMoreItemsAvailable = true;        $scope.isLoading = false;        $scope.model.list = rs;        is_one_page = rs.new_is_page;        is_two_page = rs.reply_is_page;        is_three_page = rs.essence_is_page;      });      promise.error(function(data ,state ){        console.log("服务器请求数据出错！");      });    };    fetchData();  	$scope.onSlideMove = function(data){      cid = Number(data.index) + 1 ;      $scope.noMoreItemsAvailable = true;    };        var timeoutID , hasMoving = false , hasSwitch = false;    $scope.isMoving = true;    $scope.position = 'br';    $scope.effect = 'zoomin';    $scope.method = 'click';    $scope.onScroll = function(e){      hasMoving = true;      if(hasMoving){        return;      }      $scope.isMoving = true;      $scope.$digest();    };    $scope.onScrollComplete = function(e){      $timeout.cancel(timeoutID);      timeoutID = $timeout(function(){        hasMoving = false;        $scope.isMoving = false;        $scope.$digest();       } , 1000);          };    $scope.toggle = function(state){      $location.path('/post/' + $stateParams.id);    };    $scope.loadMore = function() {      var has_page = 0;      if(cid == 1 && is_one_page){        has_page = 1;        pid = one_pid;        loadMore();      }      if(cid == 2 && is_two_page){        has_page = 1;        pid = two_pid;        loadMore();      }      if(cid == 3 && is_three_page){        has_page = 1;        pid = three_pid;        loadMore();      }      if(!has_page){        $scope.noMoreItemsAvailable = false;        $scope.$broadcast('scroll.infiniteScrollComplete');      }    };    function loadMore(){      var path = "/mobile/topics/list/" + sid + '/' + pid + '/' + cid;      var promise = $http.get(path);      promise.success(function(rs){        var is_page = rs.data.is_page;        if(cid == 1){          is_one_page = is_page;          one_pid +=1;          $scope.model.list.list_new= $scope.model.list.list_new.concat(rs.data.list);        }        if(cid == 2){          is_two_page = is_page;          two_pid +=1;          $scope.model.list.list_reply= $scope.model.list.list_reply.concat(rs.data.list);        }        if(cid == 3){          is_three_page = is_page;          three_pid +=1;          $scope.model.list.list_is_essence= $scope.model.list.list_is_essence.concat(rs.data.list);        }        $scope.$broadcast('scroll.infiniteScrollComplete');      });      promise.error(function(data){        console.log("服务器请求数据出错！");        $scope.$broadcast('scroll.infiniteScrollComplete');      });    }  })  .config(function($stateProvider) {  	$stateProvider	  .state('topic_list', {	    url: "/topic_list/:id",      templateUrl: "views/topic/topic_list.tpl.html",      controller : 'TopicListCtrl'	 });})