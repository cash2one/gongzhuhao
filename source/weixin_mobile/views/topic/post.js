'use strict';angular.module('zenmezApp')  .controller('TopicPostCtrl', function ($scope ,$state, $http, $stateParams ,FileUploader , $location , $window) {  	$scope.model = {};    $scope.model.clicked = false;  	var baseService = "/mobile/topics/create/" + $stateParams.id;  	var uploader = $scope.uploader = new FileUploader({            url: baseService,            alias : 'topic_img'        });  	uploader.onCompleteAll = function(data){        		$location.url('/topic_list/' + $stateParams.id);  	};  	$scope.onTriggerClick = function(){  		$('#file_post').trigger('click');  	};  	$scope.onPush = function(topic){      $scope.model.clicked = true;  		var promise = $http.post(baseService , topic);  		promise.success(function(data){  			if(data.stat == '1000'){  				var url ='/mobile/topics/upload/' + data.topic_id + '/topic';  				if(uploader.queue.length == 0){            $scope.model.clicked = false;  					$location.url('/topic_list/' + $stateParams.id);  					return;  				}  				angular.forEach(uploader.queue, function(item) {  					item.url = url;          });  				uploader.uploadAll();  			}  		});  		promise.error(function(data){  			console.log("与服务器交互错误!");  		});  	};  })  .config(function($stateProvider) {    $stateProvider	  .state('post', {	    url: "/post/:id",        templateUrl: "views/topic/post.tpl.html",        controller : 'TopicPostCtrl'	  });});