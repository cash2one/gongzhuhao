'use strict';angular.module('zenmezApp')  .controller('TopicReplyCtrl', function ($scope, $state, $http, $stateParams , FileUploader , $location , $window) {    $scope.model = {};    $scope.model.clicked = false;    var topic_id = $scope.topic_id = $stateParams.topic_id;    var user_id = $scope.user_id = $stateParams.user_id;    var reply_id = $scope.reply_id = $stateParams.reply_id || 0;    var baseService = "/mobile/topics/reply/"+ topic_id +"/" + reply_id;    var uploader = $scope.uploader = new FileUploader({          url: baseService,          alias : 'topic_img'      });    uploader.onCompleteAll = function(data){      $scope.model.clicked = false;      $location.url('/topic_detail/' + topic_id  + '/'+ user_id);    };    $scope.onTriggerClick = function(){      $('#file_reply').trigger('click');    };    $scope.onPush = function(topic){      $scope.model.clicked = true;      var promise = $http.post(baseService , topic);      promise.success(function(data){        if(data.stat == '1000'){          var url ='/mobile/topics/upload/' + data.data.topic_reply_id + '/reply';          if(uploader.queue.length == 0){            $scope.model.clicked = false;            $location.url('/topic_detail/' + topic_id  + '/'+ user_id);            return;          }          angular.forEach(uploader.queue, function(item) {            item.url = url;          });          uploader.uploadAll();        }      });      promise.error(function(data){        console.log("与服务器交互错误!");      });    };    })  .config(function($stateProvider) {  $stateProvider	  .state('reply', {	    url: "/reply/:topic_id/:user_id/:reply_id",        templateUrl: "views/topic/reply.tpl.html",        controller : 'TopicReplyCtrl'	  });});